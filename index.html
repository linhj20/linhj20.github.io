<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-论文阅读：SoK-Decentralized-Finance-DeFi" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/03/19/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%EF%BC%9ASoK-Decentralized-Finance-DeFi/" class="article-date">
  <time class="dt-published" datetime="2023-03-19T06:57:07.000Z" itemprop="datePublished">2023-03-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/03/19/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%EF%BC%9ASoK-Decentralized-Finance-DeFi/">论文阅读：SoK: Decentralized Finance (DeFi)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>由摘要可以知道这篇文章的脉络：</p>
<p><strong>首先，我们概述了DeFi的原始协议。其次，我们根据它们提供的操作类型对DeFi协议进行了分类。然后，我们详细考虑了DeFi协议的技术和经济安全性，特别关注了在DeFi环境中特别出现的问题。最后，我们概述了生态系统中的开放性研究挑战。</strong></p>
<p>接下来进入正文部分</p>
<h3 id="I-DEFI-FINANCE-2-0"><a href="#I-DEFI-FINANCE-2-0" class="headerlink" title="I. DEFI: FINANCE 2.0?"></a>I. DEFI: FINANCE 2.0?</h3><ul>
<li>​	DeFi的四种特性<ul>
<li>非托管的</li>
<li>无需许可（不需要准入）</li>
<li>公开审计</li>
<li>可组合的</li>
</ul>
</li>
<li>DeFi增长迅速</li>
<li>DeFi也正在面临许多风险<ul>
<li>光是过去一年，DeFi就经历了20多次重大协议漏洞；由于智能合约在组合在一起后呈现出的复杂性，甚至有许多实例表明经过审计的协议也会遭受攻击</li>
<li>即使在技术层面上，DeFi底层的区块链也面临着重大的挑战。区块链交易费在拥堵期间显著上涨，相对简单的智能合约操作的费用也达到了数百美元。不断上涨的交易成本会使小额交易退出市场，限制了可使用第一层区块链的交易类型集。</li>
</ul>
</li>
<li>本文的贡献：首先概述了DeFi的原始协议，然后讨论了以下方面内容<ul>
<li>系统化描述：根据六种操作类型，对现有的DeFi协议进行分类</li>
<li>技术安全：我们将DeFi的技术安全性定义为<strong>没有风险的收益潜力</strong>（a risk-free earning potential），并将技术攻击分为三类。</li>
<li>经济安全：我们将DeFi的经济安全定义为<strong>代理的安全激励协调</strong>（secure incentive alignment of agents）（？这个不太知道怎么翻译），并将经济攻击分为四类。<ul>
<li>The economic security risks emerge as the incentive mechanisms encoded in the underlying smart contracts make contact with reality（没明白，等第五节）</li>
</ul>
</li>
<li>整体安全：技术安全性和经济安全性之间的区别说明了DeFi生态系统的发展是在两个方面进行的。我们从这两个角度综合洞察，为未来的DeFi提出了六个主要的开放性研究挑战。</li>
</ul>
</li>
</ul>
<h3 id="II-DEFI-PRIMITIVES"><a href="#II-DEFI-PRIMITIVES" class="headerlink" title="II. DEFI PRIMITIVES"></a>II. DEFI PRIMITIVES</h3><ul>
<li><p>DeFi协议需要一个基础分布式账本；我们假设账本具有一致性、完整性和可用性这些基本的安全性质。没有这些安全性质，建立在这样的账本基础上的DeFi协议本身也会陷入不安全的境地。</p>
</li>
<li><p>在本节中，我们将注意力集中在并概述与<strong>DeFi协议安全相关的基础区块链层的基本特征</strong>。</p>
</li>
<li><h5 id="A-Smart-Contracts"><a href="#A-Smart-Contracts" class="headerlink" title="A.Smart Contracts"></a>A.Smart Contracts</h5><ul>
<li>最基础的准备：基础账本拥有（offer：？提供）使用智能合约的能力</li>
<li><strong>智能合约</strong>：编码一组用于处理交易的规则的程序，由区块链的共识规则执行，允许各方进行无需信任的经济互动。</li>
<li>智能合约依赖于基于交易的状态机的区块链，代理可以通过交易与智能合约进行交互。</li>
<li>Once a transaction is confirmed, the contract code is run by all nodes in the network and the state is updated. 一旦交易被确认，合约代码将由网络中的所有节点运行，并更新状态。</li>
<li>更新状态的基础成本体现在向（交易）发起人收取的交易费用中。</li>
<li>为了使DeFi协议在智能合约上运行，智能合约必须具备以下特点：<ul>
<li>具有足够的表现力来编码协议规则</li>
<li>允许条件执行和有界迭代</li>
<li>能够在同一执行上下文中互相通信（通常是一个交易）</li>
<li>支持原子性，即一个交易要么完全成功（状态更新），要么完全失败（状态保持不变），以确保没有任何执行会导致无效状态</li>
</ul>
</li>
<li>与DeFi相关的智能合约最显著的特点是，它们能够通过消息调用相互调用。这使得组合性成为可能。但智能合约相互作用的副作用和所有可能的相互作用空间是巨大的。</li>
<li>In a setting focused on financial applications, such complexity brings with it a great burden to understand the emergent security properties of composed smart contracts. 在专注于金融应用的环境中，这种复杂性带来了理解&#x2F;组合的智能合约的新安全性质&#x2F;的重大负担。</li>
</ul>
</li>
<li><h5 id="B-Tokens"><a href="#B-Tokens" class="headerlink" title="B. Tokens"></a>B. Tokens</h5><ul>
<li>智能合约的常见用途之一是实现（？implement）代币</li>
<li>代币的作用：<ul>
<li>代表各种资产（例如以太币或其他加密资产等）</li>
<li>提供一些实用性，例如代表参与选举的权利</li>
</ul>
</li>
<li>代币是由遵循标准代币接口的合同实现的，允许协议轻松处理不同的代币，而不必事先了解它们的实现。</li>
<li>一个常见的区分是可互换代币和不可互换代币之间的区别</li>
</ul>
</li>
<li><h5 id="C-Transaction-Execution"><a href="#C-Transaction-Execution" class="headerlink" title="C. Transaction Execution"></a>C. Transaction Execution</h5><ul>
<li>当区块链网络的参与者希望进行交易时，未确认交易的详细信息（例如交易成本、发起人、接收人、数据输入）首先会广播给一组对等节点并进行验证，然后存储在等待区域（节点的内存池）中。</li>
<li>然后，在网络节点之间传播这个内存池。</li>
<li>负责确保共识的基础账本参与者——矿工，然后根据每个交易附加的交易费用，选择在给定的块中包含哪些交易。</li>
<li>块中的交易按照这些矿工的顺序依次执行，矿工选择的顺序可以使他们获得收益。此外，他们可以插入自己的交易来获得进一步的收益。甚至可以贿赂矿工进行此类交易重新排序。<strong>矿工可以提取的价值被称为矿工可提取价值(MEV)。</strong></li>
</ul>
</li>
<li><h5 id="D-Keepers"><a href="#D-Keepers" class="headerlink" title="D. Keepers"></a>D. Keepers</h5><ul>
<li>协议（May？可能？）依赖于他们的链上状态不断更新以确保安全性。</li>
<li>在基于交易的系统中，链上状态需要由外部引发的交易来更新。</li>
<li>由于智能合约无法通过程序创建交易，因此协议必须依赖于外部实体来触发状态更新。**这些实体被称为保管人(keepers)**。他们通常会获得经济激励来（鼓励他们）触发此类状态更新。</li>
</ul>
</li>
<li><h5 id="E-Oracles"><a href="#E-Oracles" class="headerlink" title="E. Oracles"></a>E. Oracles</h5><ul>
<li>Oracle<strong>是一种机制，用于将链外数据导入区块链虚拟机，以便智能合约可以读取。</strong>这包括链外资产价格，例如ETH&#x2F;USD，以及验证预测市场结果所需的链外信息。</li>
<li>许多DeFi协议都依赖于Oracle。</li>
<li>根据设计和风险的不同，Oracle机制也各不相同<ul>
<li><strong>集中式Oracle</strong>需要信任数据提供者，并承担&#x2F;提供操纵（虚假？）数据&#x2F;所获利润大于诚实行为&#x2F;的风险。</li>
<li><strong>去中心化Oracle</strong>提供了一种替代方案。由于链外数据的正确性无法在链上验证，因此去中心化Oracle倾向于依赖&#x2F;报告链外数据的准确性和诚实性的激励机制。当然它也有自己的缺点，在后文会讨论</li>
</ul>
</li>
</ul>
</li>
<li><h5 id="F-Governance"><a href="#F-Governance" class="headerlink" title="F. Governance"></a>F. Governance</h5><ul>
<li>Governance refers to the process through which a system is able to effect change to the parameters which establish the terms on which interactions between participants within the system take place [42]. 治理（Governance）是指一个系统通过哪种过程来影响建立参与者之间交互的条款的参数的变化 （好绕的一句话，找翻译了）</li>
<li>这些变化可以通过算法或代理进行。</li>
<li>对不同的既能用在blockchain又能用在DeFi的机制了解有限</li>
<li>Presently, a common design pattern for governance schemes is for a DeFi protocol to be instantiated with a benevolent dictator who has control over governance parameters, with a promise made by the protocol to eventually decentralize its governance process. （有点复杂）目前，治理方案的常见设计模式是实现具有对治理参数控制权的慈善独裁者的DeFi协议，并承诺最终将分散其治理过程。</li>
<li>这种治理过程的分散最常通过发行治理代币来实现，使代币持有人可以通过投票或提议协议更新来参与协议治理。</li>
</ul>
</li>
</ul>
<h3 id="III-DEFI-PROTOCOLS"><a href="#III-DEFI-PROTOCOLS" class="headerlink" title="III. DEFI PROTOCOLS"></a>III. DEFI PROTOCOLS</h3><ul>
<li><p>根据操作类型，将DeFi协议分为六种</p>
</li>
<li><h5 id="A-On-chain-Asset-Exchange"><a href="#A-On-chain-Asset-Exchange" class="headerlink" title="A. On-chain Asset Exchange"></a>A. On-chain Asset Exchange</h5><ul>
<li>去中心化交易所（DEXs）是一类DeFi协议，促进了在链上的数字资产的非托管交易。除了是非托管的，即交易在任何时候都不持有用户的资金之外，DEX在链上处理所有交易，<strong>从而确保网络参与者对所有交易的公共可验证性</strong>。</li>
<li>如今，根据（？ the mechanism for price discovery）价格发现机制（在数字资产市场中，价格发现是指市场参与者通过交易来确定数字资产的价格，通过交易价格的变动反映<strong>市场对于数字资产价值的认知和预期</strong>。在加密货币市场中，由于资产的流动性和价值的波动性较大，价格发现显得至关重要。），DEX有不同的变体</li>
<li>由于它们在DeFi中的广泛应用和新颖性，我们特别关注<strong>AMMs</strong>。</li>
<li>在传统金融中，<strong>做市商</strong>是<strong>提供流动性的参与者</strong>，他们同时提供买入价和卖出价，<strong>并从买卖价差中获得利润，通过自己的账本进行交易。</strong></li>
<li>优化做市策略很快就变得复杂起来，成为复杂的优化问题。</li>
<li>AMMs通过基于简单定价规则的算法，在链上的流动性池中提供流动性，而不是依靠订单簿。</li>
<li>AMMs已经在算法博弈论中进行了研究，例如，在预测市场中的对数市场打分规则(LMSR) ，虽然它们在传统金融中基本上没有得到实施，但它们在DeFi中变得非常流行，原因如下<ul>
<li>它们允许在小型资产上轻松提供流动性</li>
<li>任何人都可以成为做市商，即使市场做市回报不是最优的</li>
<li>AMM池可以单独作为自动重新平衡的投资组合</li>
</ul>
</li>
<li>（AMM的工作机制）<ul>
<li>在AMM流动性池中，两个或两个以上资产的（assets）储备&#x2F;被锁定在智能合约中。</li>
<li>对于一个给定的流动性池，<strong>每个提供流动性的参与者都会收到新铸造的流动性代币</strong>（有点像股东，可以获得交易费的分红），用于表示他们提供的流动性份额</li>
<li>交易的实现&#x2F;是通过与智能合约的流动性（assets）储备进行交易，从而将流动性增加到一个代币的储备中，并从池中的一个或多个其他代币的储备中提取流动性。</li>
<li>交易费由流动性池保留，并按提供的每个<strong>流动性代币持有者</strong>的流动性份额按比例支付。（像Uniswap）</li>
<li>流动性提供者需要放弃他们的流动性代币，以兑换他们所拥有的流动性份额和已累积的费用。(放弃代币–兑换交易费（“分红”）)</li>
<li>在AMM中，资产的价格是由一个公式决定的，取决于货币对两侧提供的流动性的相对大小。</li>
<li>如果流动性较少，一次交易就可以导致相对于<strong>整个市场资产价格的显著波动</strong>，套利者可以通过平仓扩大利润。<ul>
<li>套利：不同市场上购买或出售同一种资产，以从价格差异中获利的过程。套利者在DeFi协议中发挥至关重要的作用。</li>
<li>套利&#x2F;用于确保AMM上的资产价格与开放市场上的价格相同。</li>
</ul>
</li>
<li>需要注意的是，随着流动性的增加和减少，池子中的各资产的储备比例会发生变化，因此，流动性提供者在撤回其流动性份额时，可能会与他最初存入的比例不同。</li>
</ul>
</li>
<li>最后谈一谈新批量结算系统<ul>
<li>交易是由分布式keeper按照算法逐批匹配完成的。</li>
<li>Keeper们通过竞争来解决一个复杂的匹配问题，他们在链上提交解决方案，协议会根据某个指标执行最优解。</li>
<li>如果这个keeper市场是竞争激烈的，交易应该会以公平价格结算。</li>
<li>但当keeper市场不具有竞争力，或者选择最佳keeper方案的方法可以被操纵时，问题可能会出现。</li>
</ul>
</li>
</ul>
</li>
<li><h5 id="B-Loanable-Funds-Markets-for-On-chain-Assets"><a href="#B-Loanable-Funds-Markets-for-On-chain-Assets" class="headerlink" title="B. Loanable Funds Markets for On-chain Assets"></a>B. Loanable Funds Markets for On-chain Assets</h5><ul>
<li>protocols for loanable funds <strong>(PLFs) 贷款基金协议</strong>，通过将存款资金汇集在智能合约中来实现在链上资产的借贷。</li>
<li>在PLF的背景下，市场指的是代币的总供应和总借入金额，其中可用的（即未借出的）存款构成市场的流动性。</li>
<li>代理人可能会直接从智能合约储备中借款，前提是该代币的市场足够流动。</li>
<li>借款的成本是由向借款人收取的利率决定</li>
<li>在贷款基金协议（PLFs）中，贷款通常有两种形式：<strong>过度抵押贷款</strong>和<strong>闪电贷款</strong>。<ul>
<li>过度抵押贷款：借款人需要提供抵押品作为担保物以覆盖债务价值，抵押品价值超过债务价值。<ul>
<li>这种方式确保了即使抵押品价值相对于债务下降相当大，仍有足够的抵押品来支付债务。</li>
<li>如果锁定的抵押品价值&#x2F;下降到低于某个清算阈值，一种keeper（清算者），将能够以折扣价购买锁定的抵押品，同时关闭借款人的债务头寸。</li>
<li>在清算情况下，被清算的借款人将收到减去&#x2F;未偿还债务和罚款&#x2F;的抵押品。</li>
</ul>
</li>
<li>闪电贷款：<strong>无抵押贷款</strong><ul>
<li>持续一个交易期间，借款人需要在交易结束时按时归还全部借款金额和利息。闪电贷款利用了区块链的原子性（即如果贷款没有在同一笔交易中归还，则交易失败）</li>
<li>去中心化交换套利和抵押品交换</li>
<li>它们也可能被用于攻击</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><h5 id="C-Stablecoins-稳定币"><a href="#C-Stablecoins-稳定币" class="headerlink" title="C. Stablecoins 稳定币"></a>C. Stablecoins 稳定币</h5><ul>
<li>非托管稳定币是一种加密资产，旨在与目标货币（常见的是美元）保持价格稳定</li>
<li><strong>需要注意，托管稳定币不属于DeFi的范畴，因为它们主要依赖于可信第三方来运营</strong></li>
<li>非托管稳定币的核心组成成分如下<ul>
<li>抵押物。这是稳定币的主要价值储存方式。抵押物的形式多样，可以是外在的，内在的或者是隐含的。</li>
<li>代理。代理在非托管稳定币中扮演至少两个角色：<ul>
<li>吸收风险</li>
<li>稳定币的用户</li>
</ul>
</li>
<li>治理。一种机制和参数集，用来统管整个协议（可以由代理或算法执行）</li>
<li>发行。一种机制，用于控制稳定币、使用抵押品（？）</li>
<li>预言机。一种机制，将外部数据导入区块链。</li>
</ul>
</li>
</ul>
</li>
<li><h5 id="D-Portfolio-Management-组合管理；资产组合管理；证券投资管理"><a href="#D-Portfolio-Management-组合管理；资产组合管理；证券投资管理" class="headerlink" title="D. Portfolio Management 组合管理；资产组合管理；证券投资管理"></a>D. Portfolio Management 组合管理；资产组合管理；证券投资管理</h5><ul>
<li>背景：对于寻求最大化收益的流动性提供者来说，流动性配置可能是一项繁琐的任务，因为收益产生的选项复杂而广泛。</li>
<li>因此，可以通过DeFi协议自动管理链上资产，这些协议充当去中心化投资基金，其中代币存入智能合约，投资策略被编码到合约，比如与其他DeFi协议进行交易</li>
<li>其唯一目的是聚合和最大化收益</li>
</ul>
</li>
<li><h5 id="E-Derivatives-衍生产品市场"><a href="#E-Derivatives-衍生产品市场" class="headerlink" title="E. Derivatives  衍生产品市场"></a>E. Derivatives  衍生产品市场</h5><ul>
<li>Derivatives are financial contracts which derive their value from the performance of underlying assets.<strong>衍生品是从基础资产的表现中获取价值的金融合约。</strong>（？？）</li>
<li>尽管约99％的衍生品交易量是在中心化交易所上完成的，但出现了一些DeFi协议，提供类似的功能。</li>
<li>我们列举了在加密资产领域流行的四种不同基本类型的Derivatives （衍生产品市场&#x2F;合约？）。<ul>
<li>Synthetic assets 合成资产：在链上复制链下资产<ul>
<li>Though less used at present, another mechanism for constructing synthetic assets is to use AMMs that enact dynamic portfolio rebalancing strategies to replicate derivative payoffs. These bear a resemblance to synthetic portfolio insurance 虽然目前使用较少，但构建合成资产的另一种机制是&#x2F;使用实施动态组合再平衡策略的AMM来复制衍生品支付。这类似于传统金融中的合成组合保险（？）</li>
</ul>
</li>
<li>Futures 期货。期货在DeFi中的采用很少。可能是因为基础加密资产的高波动性使得（主语）难以确定交易者编写期货合约时承担的风险。</li>
<li>Perpetual Swaps 永续合约。这类似于期货，但它们没有设定的到期日期或结算日期，并且是专门为加密资产市场创造和普及的<ul>
<li>永续合约允许交易者决定（通常是每天一次）通过提供资金交易来保持其position，以防止其position资金不足。</li>
<li>由于频繁的价格发现，永续合约的价格通常比期货更接近于基础资产。</li>
<li>永续合约与交易基础资产本身相比，资本效率更高，因为平台要求交易者发布少于；100％的抵押品。</li>
</ul>
</li>
<li>Options 期权<ul>
<li>目前，DeFi期权市场处于非常早期阶段，只有基本的看涨和看跌期权</li>
<li>期权采用受限的原因有三个。<ul>
<li>首先，当前的期权平台至少要100％抵押。与其中心化的同行相比，这很大程度上代表了资本低效。</li>
<li>其次，具有设定到期日期的衍生品，例如期货和期权，难以在AMM上定价。大多数AMM平台不考虑资产中的时间维度。</li>
<li>第三，期权需要流动市场进行有效的价格发现。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><h5 id="F-Privacy-preserving-Mixers-（混币？"><a href="#F-Privacy-preserving-Mixers-（混币？" class="headerlink" title="F. Privacy-preserving Mixers （混币？"></a>F. Privacy-preserving Mixers （混币？</h5><ul>
<li><p>混币是一种防止加密货币交易追踪的方法。这对于保护用户隐私非常重要，因为交易账本是公共信息。然而，这也意味着它们可以用来掩盖非法资金的来源。</p>
</li>
<li><p>混币工作原理是通过开发一个“隐蔽池”，使其在进入该池之前很难被追踪。它们通常有以下两种形式</p>
<ul>
<li><p>混合多个来源的资金，以使单个硬币不容易被追溯到单个地址（coinjoin）</p>
</li>
<li><p>直接使用零知识证明来保护交易内容的有效性</p>
</li>
</ul>
<hr>
<p>  什么是零知识证明？：一种密码学概念，用于证明某些事情是真实的，而无需泄露与该证明相关的任何其他信息。在加密货币和区块链领域，零知识证明可用于证明某个交易或信息是有效的，而不必透露交易或信息的详细信息。</p>
<hr>
</li>
<li><p>混币本身就是一种类似于DeFi的应用，并且可以作为包含在其他DeFi协议中的一部分。</p>
</li>
</ul>
</li>
</ul>
<h3 id="IV-TECHNICAL-SECURITY"><a href="#IV-TECHNICAL-SECURITY" class="headerlink" title="IV. TECHNICAL SECURITY"></a>IV. TECHNICAL SECURITY</h3><ul>
<li><p>安全风险的定义：技术的–如果一个代理可以利用区块链系统的技术结构（例如，交易的顺序和原子执行）产生无风险的利润。</p>
</li>
<li><p>我们确定了三类攻击，这些攻击属于DeFi协议的技术安全风险。所有这些技术安全风险都可能导致DeFi协议用户的财务损失。</p>
<ul>
<li>利用智能合约漏洞的攻击</li>
<li>依赖于块中交易的执行顺序的攻击</li>
<li>在单个交易中执行的攻击</li>
</ul>
</li>
<li><p>A common property of technical exploits is that they o<strong>ccur within a single block</strong>.技术性的攻击的普遍特征：发生在单个block中</p>
</li>
<li><h5 id="A-Smart-Contract-Vulnerabilities"><a href="#A-Smart-Contract-Vulnerabilities" class="headerlink" title="A. Smart Contract Vulnerabilities"></a>A. Smart Contract Vulnerabilities</h5><ul>
<li><p>智能合约是任何DeFi协议的核心，因此它们的实现中存在的任何漏洞都可能导致损失。</p>
</li>
<li><p>我们聚焦于已在DeFi环境中被利用的漏洞。</p>
</li>
<li><h5 id="Reentrancy-重入攻击"><a href="#Reentrancy-重入攻击" class="headerlink" title="Reentrancy 重入攻击"></a>Reentrancy 重入攻击</h5><ul>
<li><p>个人理解：在合同被部分执行的时候，花费更多的gas获得控制权，进行重入（重复进行）攻击</p>
</li>
<li><p>一个简单的例子是一个合约具有提款功能，该功能检查用户的内部余额，向其发送资金并更新余额。如果接收者是一个合约，它可以重复进入受害者的合约来排干资金。</p>
</li>
<li><p>虽然这种攻击已经非常广为人知，但它已经被成功地用于多次攻击DeFi协议。我们简要介绍其中两次攻击的更多细节。</p>
<hr>
<p>与ERC-20标记不同，ERC-777标记有一个钩子调用接收者在接收资金时调用接收者的函数。这意味着任何ERC-777标记都将间接导致接收者控制执行。</p>
<hr>
<ul>
<li>dForce：攻击者使用了ERC-777标记[29]中的imBTC [99]来执行攻击。在dForce攻击中，攻击者利用了这种重入攻击模式，在没有足够的抵押品支持其借贷头寸的情况下，重复增加其借贷能力，有效地排空了该协议的资金。</li>
<li>imBTC Uniswap Pool：尽管Uniswap不支持ERC-777标记[61]，但使用重入攻击，（仍然）成功排空了价值约30万美元的imBTC Uniswap [3]资金池。</li>
</ul>
</li>
<li><p>这两种攻击显示了DeFi应用中的一个常见攻击模式：识别和利用攻击向量，这些攻击向量利用了<strong>协议的相互关联性</strong>，在其中（composability risks ）<strong>组合风险往往未被充分考虑</strong>。</p>
</li>
<li><p>实际上，再入漏洞通常可以通过使用静态分析工具轻松检测和修复。防止此漏洞的两种主要方法是：</p>
<ul>
<li>使用再入保护程序，防止任何调用某个函数，直到其执行结束</li>
<li>在将执行控制权传递给不受信任的合约之前，完成所有状态更新。</li>
</ul>
</li>
</ul>
</li>
<li><h5 id="Integer-Manipulation-整数操作问题"><a href="#Integer-Manipulation-整数操作问题" class="headerlink" title="Integer Manipulation 整数操作问题"></a>Integer Manipulation 整数操作问题</h5><ul>
<li>几乎每个DeFi应用程序都以某种方式操纵货币金额。这通常不仅涉及到余额的加减，还包括将金额转换为不同的单位或不同的货币</li>
<li>我们介绍了两种最常见的整数操作问题<ul>
<li>整数溢出和下溢<ul>
<li>EVM不会在溢出或下溢的情况下引发任何异常，并且如果没有正确的检查，这种溢出可能会保持未检测状态，直到该值在某种类型的操作中使用，例如发送代币金额的交易。这通常会导致交易失败并导致智能合约的错误行为</li>
</ul>
</li>
<li>整数操作中的单位错<ul>
<li>提要：目前用于开发DeFi应用程序的主要语言是Solidity，它具有有限的类型系统，不支持运算符重载</li>
<li>此外，EVM仅支持单个类型，即32字节整数，并且没有内置支持定点数的功能。</li>
<li>为了解决这个限制，每个协议都决定使用一个任意的10的幂作为其基本单位，通常是1e18，而所有的计算都是以这个单位为基础进行的。</li>
<li>然而，由于类型系统的限制，大多数程序仅使用32字节整数。如果对两个在不同比例上的单位进行算术运算，编译器不会捕捉到这种错误。</li>
<li>这些缺陷实际上可能会导致巨大的损失，以下是一个例子（Yam）：<ul>
<li>在短时间内锁定了价值近5亿美元的代币，人们却意识到其中存在一个与算术相关的错误。</li>
<li>两个以基本单位为缩放比例的整数相乘，但结果没有缩放回去，导致结果的数量级过大。</li>
<li>这阻止了治理达到法定数量，并将所有资金锁定在协议的财务合约中，有效地永久锁定了超过75万美元的代币</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><h5 id="Logical-Bugs-逻辑错误"><a href="#Logical-Bugs-逻辑错误" class="headerlink" title="Logical Bugs. 逻辑错误"></a>Logical Bugs. 逻辑错误</h5><ul>
<li>虽然逻辑错误并不是只存在于智能合约中而是普遍存在于任何类型的软件中，但对于智能合约而言，由于它的不可变性是系统的基础，其后果可能比其他很多类型的软件更为严重，导致不可恢复的财务损失。</li>
<li>bZx:2020年9月，贷款协议bZx 由于一个微不足道的逻辑错误而遭受了800万美元以上的损失，尽管已经通过了两次独立审计。与其他ERC-20代币一样，bZx代币允许用户转移代币。由于逻辑错误，当用户将代币转移给自己时，转移的数量实际上只会被添加到其余额中，而未正确地从其余额中扣减，从而使用户可以随意将其代币数量翻倍。</li>
<li>有许多逻辑错误被审计忽略</li>
</ul>
</li>
</ul>
</li>
<li><h5 id="B-Single-Transaction-Attacks"><a href="#B-Single-Transaction-Attacks" class="headerlink" title="B. Single Transaction Attacks"></a>B. Single Transaction Attacks</h5><ul>
<li><p>我们将<strong>不需要知道其他待处理的交易就能够成功执行的攻击</strong>成为单交易攻击（？不知道怎么翻译）</p>
</li>
<li><p>这种攻击类别利用了<strong>交易的原子性</strong>和<strong>智能合约的可组合性。</strong></p>
</li>
<li><h5 id="Governance-Attacks"><a href="#Governance-Attacks" class="headerlink" title="Governance Attacks."></a>Governance Attacks.</h5><ul>
<li>去中心化治理机制协议–&gt;依赖治理代币</li>
<li>协议升级通过可执行代码形式的提案进行，治理代币持有者对其进行投票。为了提出协议更新，提议人必须持有或被委派必要数量的治理代币。</li>
<li>为了执行协议，需要一定数量的投票，通常称为<strong>法定数量</strong>。</li>
<li>攻击者可以获得足够数量的治理代币，以提出和执行恶意合约代码并窃取合约资金。</li>
</ul>
</li>
<li><h5 id="Single-Transaction-Sandwich-Attacks-（单交易）三明治攻击"><a href="#Single-Transaction-Sandwich-Attacks-（单交易）三明治攻击" class="headerlink" title="Single Transaction Sandwich Attacks. （单交易）三明治攻击"></a>Single Transaction Sandwich Attacks. （单交易）三明治攻击</h5><ul>
<li>攻击者通过<strong>操纵瞬时AMM价格</strong>来利用使用该价格的智能合约。</li>
<li>An attacker first creates an imbalance in an AMM, exploits composable contracts which rely on the manipulated price, and then reverses the imbalance to cancel out the cost of the first step. The whole sequence can be performed atomically in a single transaction risk-free.  攻击者首先在AMM中创建不平衡，利用受到操纵价格的可组合合约，然后撤消不平衡以抵消第一步的成本。整个序列可以在单个事务中原子地执行，而不会有风险。</li>
<li>创建不平衡通常需要访问大量资本。</li>
<li>为了防止这种操纵，AMM包括一个交易可承受的限制金额（或最大滑点），但这只能防止超过此金额的操纵。</li>
<li><strong>Harvest</strong>：最著名的Single Transaction Sandwich Attacks是针对Havest协议进行的。<ul>
<li>攻击者获取闪电贷–&gt;在AMM上创建两种代币的储备不平衡–&gt;把USDT铸造harvest的LP代币–&gt;在纠正曲线上的不平衡之前，兑现Harvest的LP代币（？）（挺有意思的，之后找一下事件细节）</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><h5 id="C-Transaction-Ordering-Attacks"><a href="#C-Transaction-Ordering-Attacks" class="headerlink" title="C. Transaction Ordering Attacks"></a>C. Transaction Ordering Attacks</h5><ul>
<li><p>在传统金融中，抢跑行动指的是基于未公开信息对即将到来的市场交易采取有利行动的行为。</p>
</li>
<li><p>在区块链语境下，抢跑交易指的是旨在某些其他待完成的交易前完成（以获取利益）的交易</p>
</li>
<li><p>可以通过调整gas价格来使交易靠前&#x2F;靠后执行</p>
</li>
<li><p>我们将涉及在单个块内进行抢跑和&#x2F;或延时交易，从而损害DeFi协议的技术安全性的攻击，称为<strong>交易排序攻击。</strong></p>
</li>
<li><p><strong>请注意，攻击者不需要成为矿工才能执行以下攻击，但如果攻击者是矿工，则可以无风险地进行这些攻击。</strong></p>
</li>
<li><h5 id="Displacement-Attacks"><a href="#Displacement-Attacks" class="headerlink" title="Displacement Attacks."></a>Displacement Attacks.</h5><ul>
<li><p>攻击者会抢先某些目标交易，攻击的成功与目标交易是否在之后执行无关（？）</p>
<ul>
<li>一个简单的例子是攻击者抢先一个注册域名的交易</li>
</ul>
</li>
<li><p>位移攻击的另一个方向&#x2F;适用于订单簿DEXs，参与交易的交易者需要<strong>提交交易来取消现有的订单</strong>。如果用户在交易未被填满之前因价格变动提交交易来取消未被填满的订单，<strong>攻击者可以抢先进行取消交易并填满订单。</strong></p>
</li>
<li><p>在DEXs的背景下，这种抢先行为的成功尤其可能，因为存在大量套利机器人</p>
</li>
<li><p>此外，当一个发起人打算在一次交易中获得无风险的利润时，他可能会受到广义前置攻击的威胁。</p>
</li>
</ul>
</li>
<li><h5 id="Multi-transaction-Sandwich-Attacks-（多交易三明治攻击？"><a href="#Multi-transaction-Sandwich-Attacks-（多交易三明治攻击？" class="headerlink" title="Multi-transaction Sandwich Attacks （多交易三明治攻击？"></a>Multi-transaction Sandwich Attacks （多交易三明治攻击？</h5><ul>
<li>攻击者在某个目标交易执行之前和之后，改变自动做市商的确定性价格，以从AMM（自动做市商）的流动性储备的临时不平衡中获利</li>
<li>这就是这些AMM的设计原理：兑换会导致不平衡，如果不保持平衡，就会激励套利者执行反向操作以平衡AMM池。</li>
<li>通过在创建不平衡的交易上设置更高的燃气价格来前置运行用户的交易，攻击者可以实现这一点。</li>
<li>思考：和Single Transaction Sandwich Attack的区别，大概是Single Transaction Sandwich Attack不考虑其他交易？</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="V-ECONOMIC-SECURITY"><a href="#V-ECONOMIC-SECURITY" class="headerlink" title="V. ECONOMIC SECURITY"></a>V. ECONOMIC SECURITY</h3><ul>
<li><p><strong>经济风险</strong>：如果攻击者可以通过操纵协议的激励机制，在协议或其用户的代价下获得未预期的利润。</p>
</li>
<li><p>经济风险本质上是经济设计的问题，不能仅靠技术手段解决。</p>
</li>
<li><p>解决方法：设计更好的协议激励结构。</p>
</li>
<li><p>普遍特征：它们不是无风险的，并涉及多个交易或块的系统操纵。</p>
</li>
<li><h5 id="Economic-Rationality：An-agent-is-rational-iff（当且仅当）-they-will-never-play-a-strictly-dominated-strategy"><a href="#Economic-Rationality：An-agent-is-rational-iff（当且仅当）-they-will-never-play-a-strictly-dominated-strategy" class="headerlink" title="Economic Rationality：An agent is rational iff（当且仅当） they will never play a strictly dominated strategy"></a>Economic Rationality：An agent is rational iff（当且仅当） they will never play a strictly dominated strategy</h5><ul>
<li>策略是一个计划，在每个决策节点（等价于信息集合）上，代理人明白在他们可能到达该节点上要做什么的计划</li>
<li>虽然大多数经济安全分析应该考虑到追求利润最大化的攻击者，但也有必要考虑具有其他目标的攻击者。例如，希望关闭系统的攻击者可能会决定发起攻击，只要成本适中。</li>
</ul>
</li>
<li><h5 id="Incentive-Compatibility：游戏者被激励，按照设计者的设想行动"><a href="#Incentive-Compatibility：游戏者被激励，按照设计者的设想行动" class="headerlink" title="Incentive Compatibility：游戏者被激励，按照设计者的设想行动"></a>Incentive Compatibility：游戏者被激励，按照设计者的设想行动</h5><ul>
<li>在激励兼容性的背景下，一个核心问题是机制的可持续性，也就是说，从系统中产生的激励是否允许系统在<strong>长期经济上保持安全和稳定</strong>。</li>
<li>对于稳定币，这被分为激励安全性的问题</li>
<li>一个进一步的问题，即<strong>一个经济上安全的系统是否实现了设计者所设想的期望平衡</strong>。</li>
<li>本文主要关注直接安全性问题; 然而，类似的经济稳定性问题也适用于除了稳定币以外的其他协议。</li>
</ul>
</li>
<li><h5 id="A-Overcollateralization-as-Security"><a href="#A-Overcollateralization-as-Security" class="headerlink" title="A. Overcollateralization as Security"></a>A. Overcollateralization as Security</h5><ul>
<li>抵押是协议中确保经济安全性的主要手段之一。</li>
<li>对于一个没有强身份或法律救济的无信任系统，过度抵押创造了经济激励，使贷款得到偿还，或至少确保了贷方免受损失。</li>
<li>如果代理的抵押率（抵押品价值&#x2F;借贷价值）低于协议规定的阈值，系统中的仲裁者可以以折价的估值拿走部分抵押品以减少代理的借贷风险。这旨在使系统完全抵押化。</li>
<li>然而，过度抵押并非没有风险。<ul>
<li>金融危机时期（其中抵押资产价格持续下跌）可能导致市场资源稀缺、不流通，即使进行自动去杠杆化（？automated deleveraging process）也可能导致贷款缺少抵押品。</li>
<li>这种情况下，清算变得不盈利，欠债人支付债务更难以实现</li>
</ul>
</li>
<li>另一种deleveraging的风险：借入的资产具有内生价格效应（endogenous price effects），例如当其价格受到系统中其他代理的决策影响。</li>
<li>Dai（这一段没看懂）（贴一段翻译）这种稳定币可能会出现去杠杆化反馈效应，导致稳定币本身的波动性增加。在不稳定地区，稳定币将倾向于变得不流动并且价格上涨（因为它们需要被购买以进行清算），这会迫使那些被杠杆化的投机代理人支付溢价价位进行去杠杆操作。这会导致他们的抵押品比预期更快地耗尽，使整个系统不太健康，可能导致抵押不足。</li>
</ul>
</li>
<li><h5 id="B-Threats-from-Miner-Extractable-Value"><a href="#B-Threats-from-Miner-Extractable-Value" class="headerlink" title="B. Threats from Miner Extractable Value"></a>B. Threats from Miner Extractable Value</h5><ul>
<li>许多区块链协议的假设是区块奖励足以激励“正确”的矿工行为。但是，如果MEV超过区块奖励，就会存在共识层风险。</li>
<li>DeFi应用程序产生了许多MEV来源<ul>
<li>DEX在不同交易对之间提供原子套利机会</li>
<li>建立在杠杆市场上的稳定币（如Dai）在清算杠杆头寸方面提供套利机会</li>
<li>同样，使用清算机制的其他协议（如PLFs）也会创造MEV机会。</li>
<li>当矿工被激励对基于在其他链上发生的跨链支付进行重新排列或排除交易时，也会出现MEV。</li>
</ul>
</li>
<li>削减（undercutting attack）和时间窃贼攻击（time-bandit attacks）的普遍危险<ul>
<li>undercutting attack：对抗性矿工会分叉一个具有较高MEV的块，同时保留一些可提取价值，以激励其他矿工将计算努力集中到对手的链上。</li>
<li>time-bandit attacks：攻击者从某个先前的块分叉并利用预期的MEV增加他的计算能力，并追求51%的攻击，直到实现预期的MEV。<ul>
<li>共识层风险</li>
<li>并且可能是历史上链上操作的直接后果，在以后某个时间点使矿工获利。</li>
</ul>
</li>
</ul>
</li>
<li>另一个威胁是矿工可能会勾结起来，随着时间的推移设置更多的MEV机会，例如通过审查交易在危机中补充抵押品，从而创建更多的清算事件</li>
</ul>
</li>
<li><h5 id="C-Governance-Risks-and-Governance-Extractable-Value"><a href="#C-Governance-Risks-and-Governance-Extractable-Value" class="headerlink" title="C. Governance Risks and Governance Extractable Value"></a>C. Governance Risks and Governance Extractable Value</h5><ul>
<li>协议治理通常更新系统参数甚至重新定义整个合约。</li>
<li>在许多情况下，这可能是系统随时间演变所必需的组成部分。然而，治理也可能引入影响安全的操纵向量。</li>
<li>DeFi协议的治理通常与治理代币的持有者相关，这些代币通常可以看作是协议的股份。</li>
<li>在治理具有广泛灵活性的系统中，一个重要问题是治理代币的价值来自何处。<ul>
<li>一个典型的目标是让协议通过从系统中获得现金流来补偿治理，以激励其治理代币持有者的良好管理。在这种情况下，<strong>治理代币的价值来自未来的贴现现金流</strong>。</li>
<li>Another possibility is that governance is directly aligned with underlying users–e.g., because they are the same. 另一个可能性是，治理直接与基础用户保持一致，例如，因为他们是相同的。（？）</li>
</ul>
</li>
<li>如果这些激励措施不够强大—GEV<ul>
<li>GEV的一个例子：治理者通过使协议发生变化，使得自身获得外部收益，这可能会对整个系统健康产生有害影响。</li>
<li>治理攻击<ul>
<li>治理可能无法实现激励兼容性。如果来自激励兼容性来源的治理代币价值崩溃，那么激励兼容性的区域也会缩小，并且&#x2F;<strong>形成新的联盟来攻击协议</strong>&#x2F;可能会变得有利可图。</li>
<li>这在通过闪电贷和PLF获得治理代币的便捷和低成本的情况下变得越来越棘手。</li>
</ul>
</li>
<li>还需要保护协议内少数权利的复杂性<ul>
<li>e.g. 设定限制，使得大多数治理者无法单方面更改游戏规则，比如去窃取其他少数派或用户的所有价值。</li>
</ul>
</li>
</ul>
</li>
<li>类似于资本结构的模型可以更普遍应用于DeFi协议，可用于模拟这些问题的治理安全性和激励兼容性。</li>
<li>[42]推测，在具有多个利益相关方、具有高度灵活性的治理设计的完全去中心化的<strong>稳定币</strong>的情况下，不存在长期激励兼容平衡。</li>
<li>However, they also conjecture that other DeFi systems, such as DEXs, may have wider incentive compatibility in similar situations due to the different structure of such systems. 。然而，他们还推测，其他DeFi系统（例如DEXs）在类似情况下可能具有更广泛的激励兼容性，因为这些系统的结构有所不同。</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/03/19/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%EF%BC%9ASoK-Decentralized-Finance-DeFi/" data-id="clfgwa26700019sus8uzgb5pq" data-title="论文阅读：SoK: Decentralized Finance (DeFi)" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-操作系统环境配置" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/03/06/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" class="article-date">
  <time class="dt-published" datetime="2023-03-06T10:34:33.000Z" itemprop="datePublished">2023-03-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/03/06/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/">操作系统环境配置</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>跟着实验手册走，有不一样的地方再说。</p>
<p>实验手册链接：<a target="_blank" rel="noopener" href="https://learningos.github.io/rCore-Tutorial-Guide-2023S/0setup-devel-env.html">第零章：实验环境配置 - rCore-Tutorial-Guide-2023S 文档 (learningos.github.io)</a></p>
<p>顺利进行到<code>cd qemu-7.0.0</code>，但是执行到<code>./configure --target-list=riscv64-softmmu,riscv64-linux-user</code>还是出问题了。</p>
<hr>
<p>问题描述： Cannot find Ninja</p>
<p>解决方法： <code>sudo apt-get install ninja-build</code></p>
<hr>
<p>看起来跑的很顺利了，就是依赖文件好像缺了很多……好多红色的No啊，看得我有点头大（希望没有影响，至少没有error（双手合十.jpg））</p>
<p>不知道<code>make -j$(nproc)</code>是什么作用的，编译吗？看起来好多东西，时不时卡一下，吓人</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">changing dir to build for make &quot;&quot;...</span><br><span class="line">make[1]: Entering directory &#x27;/mnt/d/qemu/qemu-7.0.0/build&#x27;</span><br><span class="line">[1/53] Generating QAPI test (include) with a custom command</span><br><span class="line">[2/20] Generating qemu-version.h with a custom command (wrapped by meson to capture output)</span><br><span class="line">make[1]: Leaving directory &#x27;/mnt/d/qemu/qemu-7.0.0/build&#x27;</span><br></pre></td></tr></table></figure>

<p>这个结果让我有点害怕，但是，只要没有error就当没有问题！（疯狂祈祷）</p>
<p>修改<code>.bashrc</code>文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export PATH=$PATH:/mnt/d/qemu/qemu-7.0.0</span><br><span class="line">export PATH=$PATH:/mnt/d/qemu/qemu-7.0.0/riscv64-softmmu</span><br><span class="line">export PATH=$PATH:/mnt/d/qemu/qemu-7.0.0/riscv64-linux-user</span><br><span class="line">export PATH=$PATH:/mnt/d/qemu/qemu-7.0.0/build</span><br></pre></td></tr></table></figure>



<p>好了！ 不过qemu第一个版本没办法识别，太奇怪了，然后报应就到后头了，，</p>
<p>ubuntu没法 git clone 笑死了</p>
<p>总结实验环境配置：终端+Ubuntu结合（笑飞了）（指的是需要用终端git clone，再用Ubuntu执行linux的相关命令行操作。</p>
<p>心梗的环节就是看到出错了（比如现在）</p>
<hr>
<p>问题描述：<code>qemu-system-riscv64 --version</code>没有正确返回，<code>LOG=DEBUG make run</code>出现了问题：<code>make: qemu-system-riscv64: Command not found</code></p>
<p>解决方法： <code>sudo apt install qemu-system-misc</code>（ubuntu系统提示）（虽然我特别害怕不兼容）（啊啊啊太奇怪了）然后运行<code>LOG=DEBUG make run</code>出错了呜呜呜</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/03/06/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" data-id="clfgwa26300009susg0869rbt" data-title="操作系统环境配置" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-心情糟糕的一天" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/02/07/%E5%BF%83%E6%83%85%E7%B3%9F%E7%B3%95%E7%9A%84%E4%B8%80%E5%A4%A9/" class="article-date">
  <time class="dt-published" datetime="2023-02-07T07:15:59.000Z" itemprop="datePublished">2023-02-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/02/07/%E5%BF%83%E6%83%85%E7%B3%9F%E7%B3%95%E7%9A%84%E4%B8%80%E5%A4%A9/">心情糟糕的一天</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>碎碎念一条</p>
<p>被梯子折腾的一天</p>
<p>原来用的梯子反复出现find config error错误</p>
<p>出现错误就算了，还半好半坏的样子</p>
<p>这导致这个梯子看起来连接的非常ok，上youtube一看，能显示ui框架，但没内容，显示未连接网络，其他的比如测试网以太坊主网一个都连不上</p>
<p>我也不知道有没有可能就是这个原因，我metamask连接不上自己手动配置参数的测试网的（bsc）可恶</p>
<p>更好笑的是</p>
<p>我翻了我以前问别人用什么梯子的消息记录</p>
<p>有个机场已经跑路了（大乐）</p>
<p>还有个梯子看着能免费用，实际不行（不行是正常的）</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/02/07/%E5%BF%83%E6%83%85%E7%B3%9F%E7%B3%95%E7%9A%84%E4%B8%80%E5%A4%A9/" data-id="cldtwy45b0000hkus362kbkjk" data-title="心情糟糕的一天" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Uniswap-v2部署工作记录（二）" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/02/06/Uniswap-v2%E9%83%A8%E7%BD%B2%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95%EF%BC%88%E4%BA%8C%EF%BC%89/" class="article-date">
  <time class="dt-published" datetime="2023-02-06T07:17:06.000Z" itemprop="datePublished">2023-02-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/02/06/Uniswap-v2%E9%83%A8%E7%BD%B2%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95%EF%BC%88%E4%BA%8C%EF%BC%89/">Uniswap-v2部署工作记录（二）</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="这一周的工作总结"><a href="#这一周的工作总结" class="headerlink" title="这一周的工作总结"></a>这一周的工作总结</h2><p>1、跟着truffle入门教程简单过了一遍</p>
<p>2、学习Uniswap官网上关于v2的知识</p>
<p>3、在仍然找不到用truffle搭建Uniswap的教程的情况下，结合truffle入门教程和其他框架搭建Uniswap的教程进行初尝试（目前已经大概摸清楚了ganache和truffle的方法，但可能合约本身有些问题，一直run out of gas）(再次更新：成功部署了！不过学长说还有一些细节没考虑）</p>
<hr>
<ul>
<li>truffle入门教程：<a target="_blank" rel="noopener" href="https://learnblockchain.cn/docs/truffle/getting-started/installation.html">https://learnblockchain.cn/docs/truffle/getting-started/installation.html</a> （中文文档<ul>
<li>整体没有什么困难，毕竟是入门教程</li>
<li>小教训：<code>truffle unbox</code> 下载之前不能使用 <code>truffle init</code>，不然会有奇怪的错误</li>
<li><code>truffle develop</code> 似乎能够和 用remix教程中，生成…账户操作等价，如果果真如此，truffle框架使用起来应该会很方便</li>
</ul>
</li>
<li>Uniswap官网：<a target="_blank" rel="noopener" href="https://docs.uniswap.org/">https://docs.uniswap.org/</a><ul>
<li>需要挂梯子（梯子经常出毛病，总感觉电脑设置不太对）</li>
<li>全英文，合理运用电脑分屏，实现看文档+查英语单词+做笔记多管齐下</li>
</ul>
</li>
</ul>
<hr>
<h3 id="truffle搭建Uniswap"><a href="#truffle搭建Uniswap" class="headerlink" title="truffle搭建Uniswap"></a>truffle搭建Uniswap</h3><p>v2-core：<a target="_blank" rel="noopener" href="https://github.com/Uniswap/v2-core">https://github.com/Uniswap/v2-core</a></p>
<p>v2-periphery：<a target="_blank" rel="noopener" href="https://github.com/Uniswap/v2-periphery">https://github.com/Uniswap/v2-periphery</a></p>
<p>一些疑惑：migrations下没有文件，可能需要自己补充？不然core和periphery好像各自干各自的，我好像只是推了一个框架上去编译一下</p>
<h5 id="v2-core"><a href="#v2-core" class="headerlink" title="v2-core"></a>v2-core</h5><ol>
<li><code>truffle init</code> <img src="/2023/02/06/Uniswap-v2%E9%83%A8%E7%BD%B2%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95%EF%BC%88%E4%BA%8C%EF%BC%89/1.png"></li>
<li><code>truffle compile</code></li>
</ol>
<ul>
<li>第一次执行的时候报错如下：<img src="/2023/02/06/Uniswap-v2%E9%83%A8%E7%BD%B2%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95%EF%BC%88%E4%BA%8C%EF%BC%89/2.png"></li>
<li>解决：修改<code>truffle-config.js</code> 中的compilers-&gt;solc-&gt;version为0.5.16</li>
<li>编译通过<img src="/2023/02/06/Uniswap-v2%E9%83%A8%E7%BD%B2%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95%EF%BC%88%E4%BA%8C%EF%BC%89/3.png"></li>
</ul>
<ol start="3">
<li><code>truffle develop</code></li>
<li><code>migrate</code>成功了！ <img src="/2023/02/06/Uniswap-v2%E9%83%A8%E7%BD%B2%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95%EF%BC%88%E4%BA%8C%EF%BC%89/4.png"></li>
</ol>
<h5 id="v2-periphery：同上，如法炮制"><a href="#v2-periphery：同上，如法炮制" class="headerlink" title="v2-periphery：同上，如法炮制"></a>v2-periphery：同上，如法炮制</h5><ul>
<li>truffle compile遇到问题： <img src="/2023/02/06/Uniswap-v2%E9%83%A8%E7%BD%B2%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95%EF%BC%88%E4%BA%8C%EF%BC%89/5.png"><ul>
<li>网上搜了一下，这个文件是同系列的Uniswap下的一个算是公共文件？</li>
<li>想到的解决方法：单独下载下来相关依赖文件再改路径？（很麻烦）还是查一下import导入中@是什么意思</li>
<li>查到了：通过npm的目录导入，是使用@<ul>
<li>附：solidity import的相关知识 <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_52708261/article/details/127064930">https://blog.csdn.net/qq_52708261/article/details/127064930</a></li>
</ul>
</li>
<li>想办法搞一个npm目录导入（谢天谢地，看了很多教程，有类似的操作，这个在Uniswap官网的相关教程有，不过官网的教程是搭建一个能够和Uniswap通信的合约）<code>npm i --save @uniswap</code></li>
<li>解决了！nice！（虽然有warning） <img src="/2023/02/06/Uniswap-v2%E9%83%A8%E7%BD%B2%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95%EF%BC%88%E4%BA%8C%EF%BC%89/6.png"></li>
</ul>
</li>
</ul>
<hr>
<p>我好像大概知道距离真正部署的差距了 </p>
<p>1、部署前的准备，包括账户，测试币，WETH合约地址和infuraKey等等、</p>
<p>2、migrate下的脚本</p>
<p>应该只要找一下别人的migrate下的脚本怎么写，然后生成新账户，获取测试币</p>
<hr>
<p>和学长聊了之后，接下来的思路应该是：</p>
<ol>
<li>用ganache生成账户之类的东西</li>
<li>写一下migrate脚本</li>
</ol>
<p>记得注意一下核心合约和外围合约的关系（比如后者的参数可能要用到前者的地址这种</p>
<hr>
<h5 id="Ganache安装-学习-使用"><a href="#Ganache安装-学习-使用" class="headerlink" title="Ganache安装-学习-使用"></a>Ganache安装-学习-使用</h5><p>参考教程：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43725548/article/details/117651078">(32条消息) Win10如何正确安装Ganache可视化客户端_张康佳的博客-CSDN博客_ganache客户端</a>  安装✔</p>
<hr>
<h5 id="migrations下脚本编写以及迁移"><a href="#migrations下脚本编写以及迁移" class="headerlink" title="migrations下脚本编写以及迁移"></a>migrations下脚本编写以及迁移</h5><p>找到了一个好东西：[<a target="_blank" rel="noopener" href="https://github.com/Uniswap/v2-core/issues/110">Feature] Truffle Migrations + Typechain · Issue #110 · Uniswap&#x2F;v2-core (github.com)</a></p>
<p>在里面找到了v2-core的migration的脚本，copy了一份，稍微修改了以后：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">UniswapV2Factory</span> = artifacts.<span class="built_in">require</span>(<span class="string">&quot;UniswapV2Factory&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">deployer</span>) &#123;</span><br><span class="line">  deployer.<span class="title function_">deploy</span>(<span class="title class_">UniswapV2Factory</span>, <span class="string">&quot;0xd97Bc11283D3C2452C40F2d8E2a22d4cA3391E3E&quot;</span>); </span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>并且仿照它给v2-periphery写了一份脚本，参数是参考了<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/212397361">手把手教你部署自己的uniswap交易所 - 知乎 (zhihu.com)</a> 中的介绍</p>
<p>v2-core部署：<img src="/2023/02/06/Uniswap-v2%E9%83%A8%E7%BD%B2%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95%EF%BC%88%E4%BA%8C%EF%BC%89/7.png"></p>
<p>v2-periphery部署：<img src="/2023/02/06/Uniswap-v2%E9%83%A8%E7%BD%B2%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95%EF%BC%88%E4%BA%8C%EF%BC%89/8.png"></p>
<hr>
<p>这里部署了router01，实际应该部署02</p>
<p>02在编译的时候有警告：<img src="/2023/02/06/Uniswap-v2%E9%83%A8%E7%BD%B2%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95%EF%BC%88%E4%BA%8C%EF%BC%89/9.png"></p>
<p>遇到了问题：<img src="/2023/02/06/Uniswap-v2%E9%83%A8%E7%BD%B2%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95%EF%BC%88%E4%BA%8C%EF%BC%89/10.png"></p>
<p>尝试解决：修改了truffle-config,js的gas值</p>
<p>再次truffle migrate，有：<img src="/2023/02/06/Uniswap-v2%E9%83%A8%E7%BD%B2%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95%EF%BC%88%E4%BA%8C%EF%BC%89/11.png"></p>
<p>ganache重新开了一块gas limit更高的值，再次尝试：<img src="/2023/02/06/Uniswap-v2%E9%83%A8%E7%BD%B2%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95%EF%BC%88%E4%BA%8C%EF%BC%89/12.png"></p>
<hr>
<p>参考：<a target="_blank" rel="noopener" href="https://ethereum.stackexchange.com/questions/94621/uniswap-router-deployment-error-uniswapv2router02-cannot-create-instance-o">solidity - Uniswap Router deployment error: “UniswapV2Router02” – Cannot create instance of UniswapV2Router02; no code at address 0xxxxxxxxx - Ethereum Stack Exchange</a></p>
<p>修改了optimizer之后部署成功了！！（撒花</p>
<p><img src="/2023/02/06/Uniswap-v2%E9%83%A8%E7%BD%B2%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95%EF%BC%88%E4%BA%8C%EF%BC%89/13.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/02/06/Uniswap-v2%E9%83%A8%E7%BD%B2%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95%EF%BC%88%E4%BA%8C%EF%BC%89/" data-id="cldshe0750000ngus8rv0fv1g" data-title="Uniswap-v2部署工作记录（二）" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-uniswap官网阅读学习" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/02/04/uniswap%E5%AE%98%E7%BD%91%E9%98%85%E8%AF%BB%E5%AD%A6%E4%B9%A0/" class="article-date">
  <time class="dt-published" datetime="2023-02-04T02:03:18.000Z" itemprop="datePublished">2023-02-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/02/04/uniswap%E5%AE%98%E7%BD%91%E9%98%85%E8%AF%BB%E5%AD%A6%E4%B9%A0/">uniswap官网阅读学习</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>uniswap的学习笔记，括号里是一些我自己的奇怪的翻译</p>
<p><a target="_blank" rel="noopener" href="https://docs.uniswap.org/">https://docs.uniswap.org/</a></p>
<p>每一部分的结构大致都是：不懂的英语名词查询+自己认为重要的句子的解读（非常不通顺警告）</p>
<p>这几天的梯子实在是不太好用，天天find config error，呜呜</p>
<h1 id="V2-Protocol"><a href="#V2-Protocol" class="headerlink" title="V2 Protocol"></a>V2 Protocol</h1><h2 id="overview"><a href="#overview" class="headerlink" title="overview"></a>overview</h2><p>sdk：帮助开发者与uniswap-v2协议交互</p>
<h2 id="Concepts：protocol-overview"><a href="#Concepts：protocol-overview" class="headerlink" title="Concepts：protocol overview"></a>Concepts：protocol overview</h2><h3 id="How-Uniswap-works"><a href="#How-Uniswap-works" class="headerlink" title="How Uniswap works"></a>How Uniswap works</h3><p>liquidity：资产流动性</p>
<p>constant product formula：The automated market(自动化市场) making algorithm used by Uniswap. See x*y&#x3D;k.</p>
<p>obiviate:排除</p>
<p>prioritize：优先考虑</p>
<p>decentralization：分散，非集权化</p>
<p>censorship：审查制度</p>
<p>deposit：放下，放置；寄存，存放，储蓄；支付（押金，定金或预缴费用）</p>
<p>equivalent：等同的，等效的</p>
<p>invariant：不变的；不变量</p>
<p>exponentially：以指数方式</p>
<p>divergence：差异，不同</p>
<p>arbitrage：套汇，套利</p>
<hr>
<ul>
<li>Uniswap is an <em><strong>automated liquidity protocol</strong></em> <em><strong>powered</strong> by a <a target="_blank" rel="noopener" href="https://docs.uniswap.org/contracts/v2/concepts/protocol-overview/glossary#constant-product-formula">constant product formula</a></em> and &#x2F;&#x2F; <strong>implemented</strong> in a system of non-upgradeable smart contracts on the <a target="_blank" rel="noopener" href="https://ethereum.org/">Ethereum</a> blockchain. </li>
<li>Uniswap不需要第三方可信任的中介，优先考虑（注重？）非集权化，抵制审查和安全</li>
<li>Each Uniswap smart contract, or pair, manages a liquidity pool （流动池）made up of reserves of two <a target="_blank" rel="noopener" href="https://eips.ethereum.org/EIPS/eip-20">ERC-20</a> tokens.（一对token）</li>
<li>任何人可以成为liquidity provider (LP) 。</li>
<li>LP—-&gt;deposit underlying token—&gt;get pool tokens</li>
<li><strong>？</strong>These tokens track pro-rata LP shares of the total reserves, and can be redeemed for the underlying assets at any time. 根据投资者在池子中的份额 随时调整underlying资产（？？）</li>
<li>pairs（个人理解为池子中的一对token）-市场的调整者</li>
<li><strong>？</strong>x * y &#x3D; k：有一个好的特性，一笔大的交易（与reserves（个人理解为池子中积蓄（？））执行起来，得到的回报(?)以指数形式差于小的交易（这样，这个智能合约不容易被攻击？  原文：Because <code>k</code> remains unchanged from the reference frame of a trade, it is often referred to as the invariant. This formula has the desirable property that larger trades (relative to reserves) execute at exponentially worse rates than smaller ones.</li>
<li>实际上，Uniswap提高百分之零点三的小费，实际上增加了reserve。这部分实现于：当LP燃烧pool token，撤销他们在reserve中的部分（原文：This functions as a payout to LPs, which is realized when they burn their pool tokens to withdraw their portion of total reserves.</li>
</ul>
<hr>
<p>几个疑问：1、Uniswap到底涉及几种货币？</p>
<p>2、这些货币之间是什么关系？什么情况下会改变它们的数量&#x2F;比例&#x2F;”价值“？（交易，deposit，reserve之间的关系？）</p>
<p>3、shares，pool tokens，reserves，token A&#x2F;B是什么关系？</p>
<h3 id="Ecosystem-Participants"><a href="#Ecosystem-Participants" class="headerlink" title="Ecosystem Participants"></a>Ecosystem Participants</h3><p>comprise：包括，包含</p>
<p>incentivize：有奖鼓励；激励</p>
<p>integrate：使合并；加入，融入群体</p>
<p>homogenous：同质的，同类的</p>
<p>provision：提供，供应</p>
<p>interoperability：互用性</p>
<p>Speculator：投机者</p>
<hr>
<ul>
<li>Uniswap生态主要包括三种使用者：liquidity providers, traders, and developers</li>
<li>LP：被鼓励去投资ERC-20代币到common liquidity pools（常规流动池）</li>
<li>trader：交换token（用一种换另外一种）（需要交百分之0.3的小费）（这一部分的小费将流向LP）（根据上一小节，LP在燃烧pool token，撤回股份（？）的时候可以拿到这部分小费）</li>
<li>developer：可以直接加入Uniswap智能合约，开发新的更刺激的交易方式、接口</li>
<li>LP有很多分类：<ul>
<li>消极的：持有token，投资，期待得到的回报是交易小费</li>
<li>专业的：主要专注市场，经常升级小费工具和追踪流动性位置的DeFi工程</li>
<li>Token projects sometimes choose to become LPs to create a liquid marketplace for their token</li>
<li>Finally, some DeFi pioneers are exploring complex liquidity provision interactions like incentivized liquidity, liquidity as collateral, and other experimental strategies. （DeFi工程师选择Uniswap，方便探索）</li>
</ul>
</li>
<li>Trader：无论哪一种，都交一样比例的平台费。每一种对增加流动性和价格准确性（？accuracy）都做了贡献<ul>
<li>投机者，利用Uniswap协议流动swap token（赚差价？</li>
<li>套利机器人（？）：通过比较不同平台的价格寻找利润</li>
<li>DAPP使用者：购买token，花在其他应用上</li>
<li>一些智能合约（Smart contracts that execute trades on the protocol by implementing swap functionality (from products like DEX aggregators to custom Solidity scripts).）</li>
</ul>
</li>
<li>Developers&#x2F;Projects：太多种了<ul>
<li>很多主要的DeFi仪表板项目中可以找到Uniswap功能</li>
<li>钱包</li>
<li>DEX（去中心化交易所）需要提取流动性， Uniswap是其最大的单一去中心化流动来源</li>
<li>…</li>
</ul>
</li>
</ul>
<p><img src="/2023/02/04/uniswap%E5%AE%98%E7%BD%91%E9%98%85%E8%AF%BB%E5%AD%A6%E4%B9%A0/1.png"></p>
<h3 id="Smart-contract"><a href="#Smart-contract" class="headerlink" title="Smart contract"></a>Smart contract</h3><p>singleton：单独的</p>
<p>minimal：极小的，极少的</p>
<p>brutalist：野兽派</p>
<p>rationale：&lt;正式&gt;根本原因，逻辑依据</p>
<p>generic：一般的通用的</p>
<p>oracle：牧师，女祭司；能提供宝贵信息的人（或书）；</p>
<p>constellation：星座；一群相似的人</p>
<p>Notably：明显的，显著的</p>
<p>meta-transaction：元事务（？）</p>
<p>integrations：结合，融合</p>
<p>would-be：想要成为的；自称的；冒充的</p>
<p>takeaway：外卖食品；外卖餐馆，要点</p>
<p>ameliorate：改善，改良</p>
<hr>
<ul>
<li>核心合约：保证所有机构（？party）与Uniswap的交互安全</li>
<li>外围合约：与核心合约交互</li>
<li>Core：包括单独的工厂合约和许多的pairs合约（which the factory is responsible for creating and indexing）<ul>
<li>The simple rationale for this is that contracts with a smaller surface area are easier to reason about, less bug-prone, and more functionally elegant.（大概意思：不易出错，功能性强</li>
<li>对于用户不太友好，不建议直接和核心合约交互</li>
<li>Factory：holds the generic bytecode responsible for powering pairs。<ul>
<li>主要工作：对于每一对特定的token pair，创建一个且仅有一个智能合约</li>
</ul>
</li>
<li>Pairs<ul>
<li>serving as automated market makers（调节市场</li>
<li>keeping track of pool token balances（追踪pool token的平衡</li>
<li>expose data which can be used to build decentralized price oracles.</li>
</ul>
</li>
</ul>
</li>
<li>Periphery：a constellation of smart contracts designed to <strong>support domain-specific interactions with the core</strong> 由于Uniswap无准入标准的生态，下面描述的合约并没有特却。但它们是一个如何安全高效地与Uniswap交互的范例<ul>
<li>Library：为抓取数据&#x2F;价格提供丰富方便的功能</li>
<li>Router：（用了Library）支持提供交易和流动性操作功能的前端基础需求；天然地支持multi-pair trades（e.g. x to y to z)；treats ETH as a first-class citizen；</li>
</ul>
</li>
<li>Design Decision<ul>
<li>Sending Tokens：… but the takeaway is that <strong>tokens must be transferred to the pair before calling any token-requiring method</strong> (the one exception to this rule is <a target="_blank" rel="noopener" href="https://docs.uniswap.org/contracts/v2/concepts/core-concepts/flash-swaps">Flash Swaps</a>.</li>
<li>WETH：不直接支持ETH，so ETH⇄ERC-20 pairs must be emulated with WETH</li>
<li>Minimum Liquidity</li>
</ul>
</li>
</ul>
<h3 id="Glossary"><a href="#Glossary" class="headerlink" title="Glossary"></a>Glossary</h3><p>fungible：代替的，可取代的</p>
<p>ratio：比例，比率</p>
<p>slippage：滑移，滑动，下降</p>
<hr>
<ul>
<li><strong>An automated market maker</strong>：a smart contract on Ethereum that <strong>holds on-chain liquidity reserves</strong>. Users can trade against these reserves at prices set by an automated market making formula.</li>
<li><strong>Factory</strong>：A smart contract that deploys a unique smart contract（pair） <strong>for any ERC20&#x2F;ERC20 trading pair</strong>.</li>
<li><strong>Pair</strong>：A smart contract deployed from the Uniswap V2 Factory that <strong>enables trading between two ERC20 tokens.</strong></li>
<li><strong>Pool</strong>：Liquidity within a pair is pooled across all liquidity providers.</li>
<li><strong>Mid price</strong>：The price between &#x2F;&#x2F; what users can buy and sell tokens at a given moment. In Uniswap this is the <strong>ratio of the two ERC20 token reserves</strong>.</li>
<li><strong>Price impact</strong>：交易的价格与MId price的差异</li>
<li><strong>Slippage</strong>：The amount the price moves in a trading pair between when a transaction is submitted and when it is executed.（提交和真正执行的时候的价格差异）</li>
<li><strong>Flash swap</strong>：A trade that uses the tokens being purchased before paying for them. （刚买就卖</li>
</ul>
<h2 id="Concepts：Core-Concepts"><a href="#Concepts：Core-Concepts" class="headerlink" title="Concepts：Core Concepts"></a>Concepts：Core Concepts</h2><h3 id="Swaps"><a href="#Swaps" class="headerlink" title="Swaps"></a>Swaps</h3><p> intuitive：直觉的，易懂的</p>
<p>underpin：支持，巩固，构成…的基础</p>
<p>proportional：成比例的；相称的，协调的</p>
<p>Anatomy：解剖学</p>
<p>aptly：恰当地，贴切地</p>
<p>correspond to：相当于</p>
<p>vulnerable：脆弱的，易受伤的</p>
<p>arbitrage：套利，套汇，仲裁</p>
<hr>
<ul>
<li><p>Introduction</p>
<ul>
<li><p>For end-users：输入一种代币，协议计算出应该输出多少另一种代币（直觉易懂的）</p>
</li>
<li><p>在本章指引中，我们将观察在协议层面，在一次交换中发生的事情，以便更好地理解Uniswap如何工作</p>
</li>
<li><p>uniswap中的swap与传统平台上的trade的区别：Uniswap的比率（一种代币&#x2F;另一种代币）是由协议自动控制的，且实时反馈</p>
</li>
<li><p>Liquidity pools are smart contracts that <strong>hold balances of two unique tokens</strong> and enforces rules around depositing and withdrawing them.</p>
<p>This rule is the <a target="_blank" rel="noopener" href="https://docs.uniswap.org/contracts/v2/concepts/protocol-overview/glossary#constant-product-formula">constant product formula</a>. <strong>When either token is withdrawn (purchased), a proportional amount of the other must be deposited (sold), in order to maintain the constant.</strong></p>
</li>
</ul>
</li>
<li><p>Anatomy of a swap：从最基础的层次来看，Uniswap v2的swap都发生在一个简单的，名称就叫做swap的函数中。</p>
<ul>
<li><code>function swap(uint amount0Out, uint amount1Out, address to, bytes calldata data);</code></li>
</ul>
</li>
<li><p>Receiving tokens</p>
<ul>
<li>As is probably clear from the function signature（明确函数特征（？））, Uniswap requires <code>swap</code> callers to <em><strong>specify how many output tokens</strong> they would like to receive</em> &#x2F;&#x2F;<strong>via the <code>amount&#123;0,1&#125;Out</code> parameters</strong>, which correspond to the desired amount of <code>token&#123;0,1&#125;</code>.</li>
</ul>
</li>
<li><p>Sending Tokens</p>
<ul>
<li>What’s not as clear is （不太清楚的）how Uniswap <em>receives</em> tokens as payment for the swap</li>
<li>传统的：需要调用者首次准许token contract，then call a function that in turn calls transferFrom on the token contract</li>
<li>Uniswap：pairs check their token balances at the <em>end</em> of every interaction.（token balance（比率）到交互的最后才确定）（所以才有Slippage？）</li>
<li>Then, at the beginning of the <em>next</em> interaction, current balances <strong>are differenced against</strong> the <strong>stored</strong> values to determine the amount of tokens that were sent by <strong>the current interactor</strong>. （有滞后）</li>
<li>The takeaway is that <strong>tokens must be transferred to pairs before swap is called</strong> (the one exception to this rule is <a target="_blank" rel="noopener" href="https://docs.uniswap.org/contracts/v2/concepts/core-concepts/flash-swaps">Flash Swaps</a>). token在swap函数调用之前应该传给pair合约</li>
<li>This means that to safely use the <code>swap</code> function, it must be called from <em>another smart contract</em>. 喂了保证安全试用swap函数，它一定要被其他智能合约调用（把token传给pair的合约？）</li>
<li>The alternative (transferring tokens to the pair and then calling <code>swap</code>) is not safe to do non-atomically because the sent tokens would be vulnerable to arbitrage.</li>
</ul>
</li>
</ul>
<h3 id="Pools"><a href="#Pools" class="headerlink" title="Pools"></a>Pools</h3><p>venue：（事件的）发生地点，场所</p>
<p> facilitate：促进，推动</p>
<p>incentivize：有奖鼓励，激励</p>
<p>proportional：成比例的，相称的，协调的</p>
<p>mint：薄荷，薄荷糖；铸造，创造</p>
<p>liquidity：资产流动性，资产变现能力；流动资产，现金；液体，液态；（市场）活跃；偿债能力</p>
<p>pro-rata：成比例的，按比例的</p>
<p>completion：完成，结束</p>
<p>retrieve：找回，检索，挽救，挽回</p>
<p>accrued：应计的，增值的，权责已发生的</p>
<p>tradable：可贸易的，可买卖的</p>
<p>discrete：分离的，个别的</p>
<p>reiterate：重申，反复说</p>
<hr>
<ul>
<li>Introduction<ul>
<li>Each Uniswap <strong>liquidity pool</strong> is a <strong>trading venue for <em>a pair of ERC20 tokens</em></strong> 流动池：一对代币的交易场所</li>
<li>pool contract刚创建时，its balances of each token are 0</li>
<li>This first liquidity provider is the one who sets the initial price of the pool. 第一个LP能够设置pool的初始价格（price）</li>
<li>LP被鼓励放置（价值）相当的token进入池子。原因：如果初始的LP放置的比率与当时的市场比率不同，中间就有差价可赚（原句：This immediately creates a profitable arbitrage opportunity, which is likely to be taken by an external party.</li>
<li>当另一个LP要给已经存在的pool放置token，必须（一般）放置符合当前市场价比率的token对。如果不的话，一样面对能被套利的风险。</li>
<li>但如果LP坚信当前的价格不是正确（合理）的：they may arbitrage it to the level they desire, and add liquidity at that price.</li>
</ul>
</li>
<li>Pool tokens<ul>
<li>Whenever liquidity is deposited into a pool, unique tokens known as <em><strong>liquidity tokens</strong></em> are minted and sent to the provider’s address.  当LP投资的时候，liquidity tokens会被铸造并送到LP的地址中。</li>
<li>这种token表示一位特定LP对pool的贡献。LP获得token的数量决定于The proportion of the pool’s liquidity provided（？这位LP对池子流动性的贡献）</li>
<li>If the provider is minting a new pool, the number of liquidity tokens they will receive will <strong>equal sqrt(x * y),</strong> where x and y represent the amount of each token provided.  第一个投资者获得的liquidity token</li>
<li>任何时候交易发生时，会收取百分之0.3的小费，这部分小费在交易结束之后按比例分给这个池子里的LP</li>
<li>（没太理解）To retrieve the underlying liquidity, plus any fees accrued, liquidity providers must <strong>“burn” their liquidity tokens</strong>, effectively exchanging them for their portion of the liquidity pool, plus the proportional fee allocation. 大概意思应该是LP要拿到上一条说的小费，应该燃烧liquidity tokens（相当于把自己在pool里的股份变现为自己应该分成到的交易小费）</li>
<li>liquidity tokens也可以销售，转让，…（像商品&#x2F;货币一样）</li>
</ul>
</li>
<li>Why pools？<ul>
<li>自动做市（核心概念）<strong>Uniswap is unique in that it doesn’t use an order book to derive the price of an asset or to match buyers and sellers of tokens. Instead, Uniswap uses what are called Liquidity Pools.</strong> （这段话出现很多次）</li>
<li>order books的局限： </li>
<li>require <strong>intermediary infrastructure</strong> to host the orderbook and match orders.</li>
<li>require active <strong>participation and management from market makers</strong> who usually use sophisticated infrastructure and algorithms, limiting participation to advanced traders</li>
<li>在以太坊，应该运用相应的优势：A blockchain-native liquidity protocol should &#x2F;&#x2F;take advantage of &#x2F;&#x2F;the trusted code execution environment, the autonomous and perpetually running virtual machine, and an open, permissionless, and inclusive access model that produces an exponentially growing ecosystem of virtual assets.</li>
<li>It is important to reiterate that <strong>a Pool is just a smart contract, operated by users calling functions on it</strong>. （Pool只是一个智能合约，操作者做相应操作的时候会调用相应的函数）Swapping tokens is calling <code>swap</code> on a Pool contract instance, while providing liquidity is calling <code>deposit</code>.</li>
<li>end-users：与接口&#x2F;&#x2F; developers可以与底层的智能合约直接交互</li>
</ul>
</li>
</ul>
<h3 id="Flash-Swaps"><a href="#Flash-Swaps" class="headerlink" title="Flash Swaps"></a>Flash Swaps</h3><p>withdraw up to：提取</p>
<p>arbitrary：任意的</p>
<p>upfront：坦率的，诚实的；预付的，预交的</p>
<hr>
<ul>
<li>（开始看不懂了sos）Uniswap flash swaps allow you to withdraw up to the full reserves of any ERC20 token on Uniswap and execute arbitrary logic at no upfront cost, provided that by the end of the transaction you either<ul>
<li>pay for the withdrawn ERC20 tokens with the corresponding pair tokens</li>
<li>return the withdrawn ERC20 tokens along with a small fee</li>
</ul>
</li>
<li>好处：Flash swaps are incredibly useful because they <strong>obviate upfront capital requirements and unnecessary order-of-operations constraints</strong> for multi-step transactions involving Uniswap.</li>
<li>……（暂时不看了，看起来比较深入的样子）</li>
</ul>
<h3 id="Oracles"><a href="#Oracles" class="headerlink" title="Oracles"></a>Oracles</h3><p>stock price：股票价格；股票行市；交易所卖价</p>
<p>retrieve：检索</p>
<p>aggregated：聚合的</p>
<p>manipulation-resistant：抵制篡改</p>
<hr>
<ul>
<li>Introduction<ul>
<li>a price oracle： any tool used to view price information about a given asset.（给定资产，用来查询价格信息的任何工具</li>
<li>对于给定的链上的某资产，怎样能够最快最好地查询到相应的价格？</li>
<li>oracle  have been implemented on an ad-hoc basis 风险比较大</li>
</ul>
</li>
<li>Uniswap V2 solution …</li>
</ul>
<h2 id="Concepts：Advanced-Topics"><a href="#Concepts：Advanced-Topics" class="headerlink" title="Concepts：Advanced Topics"></a>Concepts：Advanced Topics</h2><h3 id="Fees"><a href="#Fees" class="headerlink" title="Fees"></a>Fees</h3><hr>
<ul>
<li>Liquidity provider fees<ul>
<li>百分之0.3（这个数字我记住了）<strong>This fee is split by liquidity providers proportional to their contribution to liquidity reserves.</strong>  简称分红x</li>
<li>This increases the value of liquidity tokens.  liquidity tokens增值了</li>
<li>Fees are collected by burning liquidity tokens to remove a proportional share of the underlying reserves. 需要销毁投资（份额）才能拿到小费（分红）</li>
<li>因为小费被增加到liquidity pools中，因此常量在每一笔交易之后增加了。单笔交易中，the invariant represents <code>token0_pool / token1_pool</code> at the end of the previous transaction 常量展示的是过去交易结束后的 <code>token0_pool / token1_pool</code></li>
</ul>
</li>
<li>Protocol Fees<ul>
<li>目前没有，未来可能要有百分之0.05</li>
</ul>
</li>
<li>Protocol Charge Calculation<ul>
<li>未来可能的协议费可能并不影响交易者小费，但可能影响liquidity providers的分红</li>
<li>Rather than calculating this charge on swaps, which would significantly increase gas costs for all users, the charge is instead calculated <strong>when liquidity is added or removed</strong>. （与其一笔一笔地算，不如在liquidity被添加或移除的时候算</li>
</ul>
</li>
</ul>
<h3 id="Pricing"><a href="#Pricing" class="headerlink" title="Pricing"></a>Pricing</h3><p>underpin：支持，巩固；构成…的基础</p>
<hr>
<ul>
<li>How are prices determined？<ul>
<li>The ratio of tokens in the pool, in combination with the constant product formula, ultimately determine the price that a swap executes at. 决定执行swap的价格的因素：池中token的比率，the constant product formula</li>
</ul>
</li>
<li>How Uniswap handles prices<ul>
<li>V1<ul>
<li>trades are always executed at the “<strong>best possible” price</strong>, calculated at execution time</li>
<li>Somewhat confusingly, this calculation is actually accomplished <strong>with one of two different formulas</strong>, depending on <strong>whether the trade specifies an exact <em>input</em> or <em>output</em> amount.</strong></li>
<li>一般这种差异不大，但也有极端情况，复杂情况</li>
</ul>
</li>
<li>V2<ul>
<li>Initial attempts to support both functions in V2 proved inelegant, and the decision was made to <strong>not provide any pricing functions in the core</strong>. 在核心合约中不提供任何pricing的功能</li>
<li>Instead, <strong>pairs</strong> directly check whether the <strong>invariant was satisfied</strong> (accounting for fees) <strong>after every trade.</strong></li>
<li>One downstream benefit is that V2 pairs will more naturally support other flavors of trades which may emerge (更能支持其他可能出现的种类的交易)</li>
<li>At a high level, in Uniswap V2, <em>trades must be priced in the periphery</em></li>
</ul>
</li>
</ul>
</li>
<li>Pricing Trades<ul>
<li>当我们在Uniswap做swap时，我们总是期望一下两种情况发生<ul>
<li>给定一定的输入，得到尽可能多的输出</li>
<li>明确要得到的输出，使得输入尽可能少</li>
</ul>
</li>
<li>However, it is <em>not safe to perform this lookup and rely on the results without access to an external price</em>. 但是仅仅看Uniswap内部的比率，而不顾Uniswap外市场的价格，是危险的</li>
<li>危险的原因：从我们查询得到比例，到最后交易落实（confirmed）有一个时间差，在这段时间中比率可能因为别人的操作（交易）而变化</li>
<li>To prevent these types of attacks, it’s vital to submit swaps <em>that have access to knowledge about the “fair” price their swap should execute at</em>.  In other words, swaps need access to an <em>oracle</em>, to be sure that the best execution they can get from Uniswap is close enough to what the oracle considers the “true” price.  就是swap需要能够查询市场价格，保证交易的时候价格是合理的</li>
</ul>
</li>
</ul>
<h3 id="Understanding-Returns"><a href="#Understanding-Returns" class="headerlink" title="Understanding Returns"></a>Understanding Returns</h3><hr>
<ul>
<li>There is a risk of losing money during large and sustained movement in the underlying asset price compared to simply holding an asset.</li>
<li>Risks</li>
<li>Example from the article</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/02/04/uniswap%E5%AE%98%E7%BD%91%E9%98%85%E8%AF%BB%E5%AD%A6%E4%B9%A0/" data-id="cldsh9fbr0000jwus3ayc4nl2" data-title="uniswap官网阅读学习" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-230202会议记录" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/02/02/230202%E4%BC%9A%E8%AE%AE%E8%AE%B0%E5%BD%95/" class="article-date">
  <time class="dt-published" datetime="2023-02-02T10:42:48.000Z" itemprop="datePublished">2023-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/02/02/230202%E4%BC%9A%E8%AE%AE%E8%AE%B0%E5%BD%95/">230202会议记录</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>迟到了十分钟呜呜，尽量听尽量听</p>
<p>覆盖率不太适用</p>
<p>1、不好收集，容易产生噪音，可能和很多进程交互</p>
<p>2、哪怕指示表明出现错误，也不能告诉人们怎么修正错误</p>
<p>Error Message Guided Fuzzing</p>
<p>两种错误</p>
<p>1、参数错误（类型正确，其他约束）（例如整型</p>
<p>2、issues with internal state（逻辑问题，例如还没创建对象，就企图操作对象</p>
<p><img src="/2023/02/02/230202%E4%BC%9A%E8%AE%AE%E8%AE%B0%E5%BD%95/1.png"></p>
<p><img src="/2023/02/02/230202%E4%BC%9A%E8%AE%AE%E8%AE%B0%E5%BD%95/2.png"></p>
<p>左边：参数错误，右边：逻辑错误</p>
<p>三千多条信息，比较麻烦</p>
<p>如果从软件分析的角度：可以运用反向污点传播，把报错信息和实际的参数关联出来</p>
<p>两个子问题：API和内部变量关联；内部变量和报错信息的关联</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/02/02/230202%E4%BC%9A%E8%AE%AE%E8%AE%B0%E5%BD%95/" data-id="cldpb3vg70000fsus4g7o7lyr" data-title="230202会议记录" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Uniswap-v2部署工作记录（一）" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/01/30/Uniswap-v2%E9%83%A8%E7%BD%B2%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95%EF%BC%88%E4%B8%80%EF%BC%89/" class="article-date">
  <time class="dt-published" datetime="2023-01-30T06:36:59.000Z" itemprop="datePublished">2023-01-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/01/30/Uniswap-v2%E9%83%A8%E7%BD%B2%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95%EF%BC%88%E4%B8%80%EF%BC%89/">Uniswap-v2部署工作记录（一）</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>1.23-1.30</p>
<p>目前仍然是环境调试阶段呢，心累QAQ</p>
<hr>
<p>这几天工作总结：磕磕绊绊地找教程，无止尽地调环境，环境的bug怎么看不到头啊……</p>
<hr>
<h3 id="找教程历程"><a href="#找教程历程" class="headerlink" title="找教程历程"></a>找教程历程</h3><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/212397361">https://zhuanlan.zhihu.com/p/212397361</a> 手把手叫教你部署uniswap</p>
<p> 通过助记词生成新账户<br> b站视频：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1VV411o7Dt/">https://www.bilibili.com/video/BV1VV411o7Dt/</a><br> yarn无法使用<br> 解决：1、把nodejs下的global放入环境变量path中<br> 2、设置权限 <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_55333190/article/details/122492166">https://blog.csdn.net/weixin_55333190/article/details/122492166</a></p>
<p> 跟着视频 新建文件夹D:\实验室\myblockchain</p>
<p> 开始看教程！（flag：把这个教程跟完）（除非不可抗因素：卡着了）<br> <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1ph411e7bT">https://www.bilibili.com/video/BV1ph411e7bT</a><br> 记住这个网址：cn.etherscan.com-试图打开-失败了xs</p>
<p> 上面的教程用remix，和学长交流后决定不用remix，而改用truffle。又要重新开始找教程了呜呜</p>
<hr>
<p> 1.28晚：折腾一晚上没在b站找到用truffle搭建的，在博客园找到了一个，不过人家似乎经历了一些自己的整合，但是源码已经找不到了（sigh）同时以太坊网站和其他外网都上不去，梯子时不时提示什么config error</p>
<p> 1.29：继续找教程，找到了hardrat（？）和foundry的，就是没找到truffle的视频教程；解决了翻墙问题，最后的最后竟然是因为梯子没有升级到最新版本（一口老血喷了出来）</p>
<p> 决定先跟着这个教程：<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000040401731">https://segmentfault.com/a/1190000040401731</a> 把truffle当成一个框架！</p>
<hr>
<h3 id="调试环境"><a href="#调试环境" class="headerlink" title="调试环境"></a>调试环境</h3><p> yarn编译第一步就出错了（令人窒息的满屏error</p>
<p> <img src="/2023/01/30/Uniswap-v2%E9%83%A8%E7%BD%B2%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95%EF%BC%88%E4%B8%80%EF%BC%89/1.png"></p>
<p> 一个类似的但不是sha的：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_34373197/article/details/122809786">https://blog.csdn.net/qq_34373197/article/details/122809786</a><br> 建议是node重装成比较低的版本（倒吸一口凉气）（planB，感觉不太好行动）</p>
<p> 另一个sha的，但还没看到解决方案，全是same的英文网站：<a target="_blank" rel="noopener" href="https://github.com/phusion/node-sha3/issues/32">https://github.com/phusion/node-sha3/issues/32</a></p>
<p> <strong>我先干一件事情：把梯子关掉重试一下。感觉哪怕没有用也得保持梯子关掉（至少编译配环境过程中），不然问题有点多</strong><br> error依旧！那没事了</p>
<p><img src="/2023/01/30/Uniswap-v2%E9%83%A8%E7%BD%B2%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95%EF%BC%88%E4%B8%80%EF%BC%89/2.png"></p>
<p> 别人的错误信息：<br><img src="/2023/01/30/Uniswap-v2%E9%83%A8%E7%BD%B2%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95%EF%BC%88%E4%B8%80%EF%BC%89/3.png"></p>
<p> 我的对应信息：</p>
<p><img src="/2023/01/30/Uniswap-v2%E9%83%A8%E7%BD%B2%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95%EF%BC%88%E4%B8%80%EF%BC%89/4.png"><br> 那可能就不是node的版本问题了<br> 查一下vs</p>
<hr>
<h4 id="和VS杠上了"><a href="#和VS杠上了" class="headerlink" title="和VS杠上了"></a>和VS杠上了</h4><p> 有个解决方法是安装Vs。</p>
<p> 另一个办法是装拓展。<br> <strong>先试一下装拓展：</strong></p>
<p> <img src="/2023/01/30/Uniswap-v2%E9%83%A8%E7%BD%B2%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95%EF%BC%88%E4%B8%80%EF%BC%89/5.png"><br> 卡住了（</p>
<p> 经过了一番兵荒马乱居然装上了，但怀疑有隐患。</p>
<p><img src="/2023/01/30/Uniswap-v2%E9%83%A8%E7%BD%B2%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95%EF%BC%88%E4%B8%80%EF%BC%89/6.png"></p>
<p> <strong><strong>血的教训：1、文件名最好用英文</strong><br> 2、因为装拓展而多出来的文件夹不要删除，否则会有这样的灵异现象：</strong></p>
<p><img src="/2023/01/30/Uniswap-v2%E9%83%A8%E7%BD%B2%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95%EF%BC%88%E4%B8%80%EF%BC%89/7.png"><br> 事实是C:\Program Files (x86)\Microsoft Visual Studio这个文件夹我动手把它删了。。。看到它还找到了不禁有点毛骨悚然</p>
<p> 最终解决问题参考的网页：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_48391379/article/details/117187522">https://blog.csdn.net/weixin_48391379/article/details/117187522</a><br> install卡住后如果crl+c退出后，最好remove一下，不然感觉不太干净的样子。</p>
<p> yarn的编译还是老问题：</p>
<p> <img src="/2023/01/30/Uniswap-v2%E9%83%A8%E7%BD%B2%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95%EF%BC%88%E4%B8%80%EF%BC%89/8.png"></p>
<p> 借鉴：<a target="_blank" rel="noopener" href="https://blog.csdn.net/lc315yuhuofei/article/details/106015745">https://blog.csdn.net/lc315yuhuofei/article/details/106015745</a> 的更新gyp<br> 结果：没解决</p>
<p> 想试一下这个指令：<br> npm install –global –production windows-build-tools –vs2017<br> 结果：没能解决</p>
<p> 尝试用cnpm i -g windows-build-tools<br>       卡在python2.7…后<br>       解决借鉴：<a target="_blank" rel="noopener" href="https://blog.csdn.net/oqzuser1234asd/article/details/116169889">https://blog.csdn.net/oqzuser1234asd/article/details/116169889</a> 在temp文件添加文件以及指令</p>
<p> 但是yarn的这个错误还是没解决。。。<br> <strong>gyp ERR! UNCAUGHT EXCEPTION</strong><br> <strong>gyp ERR! stack Error: spawn C:\Program Files (x86)\Microsoft Visual Studio\2017\BuildTools\MSBuild\15.0\Bin\MSBuild.exe ENOENT</strong></p>
<p> 尝试用cnpm i -g windows-build-tools</p>
<p>虽然没有卡住</p>
<p>但是有新bug：Could not install Visual Studio Build Tools</p>
<p> <strong>决定下载vs了</strong><br> 在官网下载了2017版本的，并且对“桌面开发工具”打了勾安装<br> 但还是没有vs build tool</p>
<p> 正在找vs build tool 目前参考链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/Zhou_Yulong/article/details/117264550">https://blog.csdn.net/Zhou_Yulong/article/details/117264550</a><br> 其中下载vsbuildtoolfull.exe的，提示一个安装包损坏<br> 试着离线安装一下 百度yp能不能414啊这个限速</p>
<hr>
<p> 百度云盘真的够6</p>
<p>我重新搭建了这个博客框架（之前在旧电脑没搭起来）</p>
<p>吃了个午饭洗了碗</p>
<p>还把研究了hexo文章怎么发布，文章怎么添加图片</p>
<p>它一个1G的压缩包还没下载完</p>
<p>我真的谢谢你（想刀人的眼神藏不住了</p>
<p>hexo搭建教程： <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_54796785/article/details/126053172">https://blog.csdn.net/qq_54796785/article/details/126053172</a></p>
<p>hexo发布文章教程：<a target="_blank" rel="noopener" href="https://blog.csdn.net/PaperJack/article/details/120479912">https://blog.csdn.net/PaperJack/article/details/120479912</a></p>
<p>hexo文章添加图片教程：<a target="_blank" rel="noopener" href="https://blog.csdn.net/soul7y/article/details/106753778">https://blog.csdn.net/soul7y/article/details/106753778</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/01/30/Uniswap-v2%E9%83%A8%E7%BD%B2%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95%EF%BC%88%E4%B8%80%EF%BC%89/" data-id="cldifmih80000x8ushl9p6k1a" data-title="Uniswap-v2部署工作记录（一）" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-hello-world" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/01/30/hello-world/" class="article-date">
  <time class="dt-published" datetime="2023-01-30T05:40:03.071Z" itemprop="datePublished">2023-01-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/01/30/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/01/30/hello-world/" data-id="cldidtpgp0000k0useig5aqp0" data-title="Hello World" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/03/19/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB%EF%BC%9ASoK-Decentralized-Finance-DeFi/">论文阅读：SoK: Decentralized Finance (DeFi)</a>
          </li>
        
          <li>
            <a href="/2023/03/06/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/">操作系统环境配置</a>
          </li>
        
          <li>
            <a href="/2023/02/07/%E5%BF%83%E6%83%85%E7%B3%9F%E7%B3%95%E7%9A%84%E4%B8%80%E5%A4%A9/">心情糟糕的一天</a>
          </li>
        
          <li>
            <a href="/2023/02/06/Uniswap-v2%E9%83%A8%E7%BD%B2%E5%B7%A5%E4%BD%9C%E8%AE%B0%E5%BD%95%EF%BC%88%E4%BA%8C%EF%BC%89/">Uniswap-v2部署工作记录（二）</a>
          </li>
        
          <li>
            <a href="/2023/02/04/uniswap%E5%AE%98%E7%BD%91%E9%98%85%E8%AF%BB%E5%AD%A6%E4%B9%A0/">uniswap官网阅读学习</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>